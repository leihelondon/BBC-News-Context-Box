/*! Echo - v4.0.3, 2015-07-28.
 *  Copyright (c) 2013 BBC, all rights reserved.
 */
/* Copyright (c) 2013 comScore, Inc. comScore SDK 4.1309.17
 * All rights reserved.
 * By using this software, you are agreeing to be bound by the
 * terms of this policies: http://www.comscore.com/About_comScore/Privacy_Policy
 */

/*! BBC RUM Client - v0.4.5 - 2015-04-08  Copyright (c) 2015 !*/

define("echo-4.0.3/meta",{NAME:"echo_js",VERSION:"4.0.3",API_VERSION:"10.0.0"}),define("echo-4.0.3/util/debug",["require"],function(){function e(e){var t;return t="undefined"==typeof console||null===console||"undefined"==typeof console[e]?function(){}:void 0!==console[e].bind?console[e].bind(console):function(){Function.prototype.apply.call(console[e],console,arguments)}}function t(){}var n={log:t,warn:t,error:t},s=!1;return n.isEnabled=function(){return s},n.enable=function(){n.log=e("log")||function(e){alert(e)},n.warn=e("warn")||n.log,n.error=function(e){throw new Error("ECHO_DEBUG: "+e)},s=!0},n}),define("echo-4.0.3/util/methods",["require","./debug"],function(e){function t(e){var n={};for(var s in e)try{n[s]=e[s].constructor===Object?t(e[s]):e[s]}catch(r){n[s]=e[s]}return n}function n(e,s,r){var i=r?e:t(e);for(var o in s)try{i[o]=s[o].constructor===Object?n(i[o],s[o]):s[o]}catch(a){i[o]=s[o]}return i}function s(e,t){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t)return!0;return!1}function r(e,s){for(var r=(s?t(e):e)||{},i=arguments,o=2,a=i.length;a>o;o++)"object"==typeof i[o]?n(r,i[o],!0):r[i[o]]=i[++o];return r}function i(e,t,n){return n?r(e,!0,t,n):r(e,!0,t)}function o(e,t,n){return e||(n?u.warn("AssertionFailed: "+t):u.error("AssertionFailed: "+t)),e}function a(e,t,n){return o(s(e,t),n)}var u=e("./debug");return{clone:t,combineObjects:n,addKV:i,containsValue:s,extend:r,assert:o,assertContainsValue:a}}),define("echo-4.0.3/config/keys",[],function(){var e={ECHO_ENABLED:"enabled",ECHO_TRACE:"trace",ECHO_DEVICE_ID:"device_id",ECHO_NAME:"lib_name",ECHO_VERSION:"lib_version",COMSCORE_ENABLED:"comscore.enabled",COMSCORE_URL:"comscore.url",COMSCORE_SITE:"comscore.site",RUM_ENABLED:"rum.enabled",RUM_URL:"rum.url",BARB_ENABLED:"barb.enabled",BARB_SITE_CODE:"barb.site_code",BARB_DEBUG:"barb.debug"};return e}),define("echo-4.0.3/enumerations",[],function(){var e={ApplicationType:{WEB:"web",MOBILE_WEB:"mobile-web",RESPONSIVE:"responsive",MOBILE_APP:"mobile-app",BIGSCREEN_HTML:"bigscreen-html",BIGSCREEN_FLASH:"bigscreen-flash",BIGSCREEN_APP:"bigscreen-app"},WindowState:{FULL:"full",NORMAL:"norm",MINIMISED:"min",MAXIMISED:"max"},AvType:{AUDIO:"audio",VIDEO:"video"},RetrievalType:{STREAM:"stream",DOWNLOAD:"download"},Form:{LONG:"long",SHORT:"short"},PIPsType:{CLIP:"clip",EPISODE:"ep"},MediaConsumptionMode:{ON_DEMAND:"od",LIVE:"li"},EchoScheduleMode:{ON:"on-schedule",OFF:"off-schedule"}};return e}),define("echo-4.0.3/config/generator",["require","../util/debug","../util/methods","../meta","./keys"],function(e){function t(e){return"string"==typeof e&&e.length>0}function n(e){return e.match(/[a-zA-Z]+/)}function s(e){return!e.match(/\?/)}function r(e){return _.assert("boolean"==typeof e[p.ECHO_ENABLED],'Config: "enabled" must be boolean, got '+e[p.ECHO_ENABLED])&&_.assert(null===e[p.ECHO_DEVICE_ID]||"string"==typeof e[p.ECHO_DEVICE_ID]&&e[p.ECHO_DEVICE_ID].length,"ECHO.DEVICE_ID must be an non-empty string")}function i(e){return _.assert(t(e[p.COMSCORE_URL]),"Must have config value for COMSCORE_URL")&&_.assert(s(e[p.COMSCORE_URL]),'Comscore Config: Tailing "?" or url parameters not allowed')&&_.assert("boolean"==typeof e[p.COMSCORE_ENABLED],'ComScore config: "ENABLED" bust be boolean')}function o(e){return _.assert(t(e[p.RUM_URL]),"RUM Config: Must have config value for RUM_URL")&&_.assert(s(e[p.RUM_URL]),'RUM Config: Tailing "?" and URL uparameters not allowedfor RUM.URL')&&_.assert("boolean"==typeof e[p.RUM_ENABLED],'RUM config: "ENABLED" bust be boolean')}function a(e){return t(e[p.BARB_SITE_CODE])?n(e[p.BARB_SITE_CODE])?"boolean"!=typeof e[p.BARB_DEBUG]?(l.error("Config Error: KEYS.BARB_DEBUG must be a boolean"),!1):!0:(l.error("Config Error: KEYS.BARB_SITE_CODE must match [a-zA-Z]"),!1):(l.error("Config Error: KEYS.BARB_SITE_CODE must have a value"),!1)}function u(e){var t=_.extend(d,!0,e||{},E);return r(t)&&i(t)&&o(t)&&a(t)?t:null}var l=e("../util/debug"),_=e("../util/methods"),c=e("../meta"),p=e("./keys"),d={};d[p.ECHO_ENABLED]=!0,d[p.ECHO_DEVICE_ID]=null,d[p.COMSCORE_URL]="http://sa.bbc.co.uk/bbc/bbc/s",d[p.COMSCORE_ENABLED]=!0,d[p.RUM_URL]="http://ingest.rum.bbc.co.uk",d[p.RUM_ENABLED]=!1,d[p.BARB_ENABLED]=!1,d[p.BARB_DEBUG]=!1,d[p.BARB_SITE_CODE]="bbcdotcom";var E={};return E[p.ECHO_NAME]=c.NAME,E[p.ECHO_VERSION]=c.VERSION,{generate:u}}),define("echo-4.0.3/util/helper",["require","./methods","./debug"],function(e){function t(e){var t=e&&e.replace(/(^\W*)|(\W*$)/g,"")||"no.name.page";return t=t.toLowerCase().replace(/[^a-z0-9\.]+/g,"_"),e!==t&&((null===e||"string"!=typeof e||0===e.replace(/ */,"").length)&&u.error("Countername must be a non-empty string"),u.warn(e&&-1!==e.search(/-/)?'Submitted countername ("'+e+'") contains at least one "-". Dashes are not permitted but, for legacy reasons, "-" and "_" are equivalent in DAx. Echo converts dashes to underscores, so the countername will be sent as "'+t+'"':'countername may only conatin: [a-z0-9._], got "'+e+'". This will be cleaned up and sent as "'+t+'"')),-1===t.search(/\.page$/)&&(t+=".page"),t}function n(e){var t=e&&e.replace(/(^\W*)|(\W*$)/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/(^_)|(_$)/g,"")||"";return a.assert(e===t,'Label key can only contain: [a-z0-9_], and no consecutive "_"s or "_" at the begining or end, got "'+e+'". This will be sent as "'+t+'"',!0),t}function s(e){var t=e||"";return"number"==typeof e||"boolean"==typeof e?e.toString():"string"!=typeof e&&""!==t?void u.error("Label must have number, boolean or string value"):(t=t&&t.replace(/(^\W*)|(\W*$)/g,"").toLowerCase().replace(/[^0-9a-z._ ]+/g,"-").replace(/(^-)|(-$)/g,""),a.assert(e===t,'Labels value can only contain [ 0-9a-z._-], and no consecutive "-"s and no - at the start or end. Got "'+e+'", will be replaced with "'+t+'"',!0),t)}function r(e){var t=e||"";return"number"==typeof e||"boolean"==typeof e?e.toString():"string"!=typeof e&&""!==t?void u.error("Label must have number, boolean or string value"):(t=t&&t.replace(/(^\W*)|(\W*$)/g,"").toLowerCase().replace(/[^0-9a-z._]+/g,"-").replace(/(^-)|(-$)/g,""),a.assert(e===t,'Managed Labels values (name, app_name, app_type, app_version, ml_name, ml_version) can only contain [0-9a-z._-], and no consecutive "-"s and no - at the start or end. Got "'+e+'", will be replaced with "'+t+'"',!0),t)}function i(e){if("number"==typeof e||"boolean"==typeof e)return e.toString();var t=e&&e.replace(/(^\W*)|(\W*$)/g,"").replace(/[^0-9a-zA-Z._]+/g,"-").replace(/(^-)|(-$)/g,"")||"";return a.assert(e===t,'Language label value can only contain [0-9a-zA-Z._-], and no consecutive "-"s and no - at the start or end. Got "'+e+'", will be replaced with "'+t+'"',!0),t}function o(e){var t,i={};for(var o in e)t=n(o),i[t]=a.containsValue(l,t)?r(e[o]):s(e[o]);return i}var a=e("./methods"),u=e("./debug"),l=["name","app_name","app_type","app_version","ml_name","ml_version"];return{cleanCounterName:t,cleanLabelKey:n,cleanLabelValue:s,cleanManagedLabelValue:r,cleanLangValue:i,cleanLabels:o}}),define("echo-4.0.3/delegate/comscore/label-keys",{BBC_APPLICATION_NAME:"app_name",BBC_APPLICATION_TYPE:"app_type",BBC_COUNTER_NAME:"name",BBC_LANGUAGE:"language",DEVICE_ID:"istats_visitor_id",BBC_MEASUREMENT_LIB_NAME:"ml_name",BBC_MEASUREMENT_LIB_VERSION:"ml_version",ECHO_TRACE:"trace",ECHO_EVENT_NAME:"echo_event",EVENT_TRIGGERED_BY_USER:"ns_st_ui",STREAMSENSE_CUSTOM_EVENT_TYPE:"ns_st_ev",USER_ACTION_TYPE:"action_type",USER_ACTION_NAME:"action_name",PLAYLIST_END:"ns_st_pe",REWIND_FF_RATE:"ffrw_rate",COMSCORE_SITE:"ns_site",PLAYER_NAME:"ns_st_mp",PLAYER_VERSION:"ns_st_mv",PLAYER_WINDOW_STATE:"ns_st_ws",PLAYER_VOLUME:"ns_st_vo",PLAYER_POPPED:"bbs_st_pop",PLAYER_SUBTITLED:"bbc_st_sub",PLAYLIST_NAME:"ns_st_pl",PLAYLIST_CLIP_COUNT:"ns_st_cp",PLAYLIST_LENGTH:"ns_st_ca",MEDIA_PID:"ns_st_ci",MEDIA_LENGTH:"ns_st_cl",MEDIA_BITRATE:"ns_st_br",MEDIA_STREAM_TYPE:"ns_st_ty",MEDIA_IS_LIVE:"ns_st_li",MEDIA_EPISODE_ID:"episode_id",MEDIA_CLIP_ID:"clip_id",MEDIA_CLIP_NUMBER:"ns_st_cn",MEDIA_PART_NUMBER:"ns_st_pn",MEDIA_TOTAL_PARTS:"ns_st_tp",MEDIA_MEDIUM:"bbc_st_med",MEDIA_LIVE_OR_ONDEMAND:"bbc_st_lod",MEDIA_FORM:"bbc_st_mf",MEDIA_RETRIEVAL_TYPE:"bbc_st_ret",MEDIA_SCHEDULE_INDICATOR:"bbc_st_sch",MEDIA_CODEC:"bbc_st_co",MEDIA_CDN:"bbc_st_cdn",MEDIA_VERSION_ID:"version_id",MEDIA_SERVICE_ID:"service_id",APP_PLATFORM_NAME:"ns_ap_pn",APP_PLATFORM_RUNTIME:"ns_ap_pfm",APP_OS_VERSION:"ns_ap_pfv",APP_DEVICE_NAME:"ns_ap_device",APP_SCREEN_RESOLUTION:"ns_ap_res",APP_LANGUAGE:"ns_ap_lang",ENV_CHAR_SET:"ns_c",ENV_TITLE:"c8",ENV_URL:"c7",ENV_REFERRER:"c9",APP_NAME:"ns_ap_an",APP_VERSION:"ns_ap_ver",NO_COOKIES:"ns_nc",COOKIE_POLICY:"bbc_mc",BBC_ID_LOGGED_IN:"bbc_identity",WEB_SCREEN_RES:"screen_resolution"}),define("echo-4.0.3/util/cookies",[],function(){var e={getCookieValueByName:function(e,t){var n=t||window;if("undefined"==typeof n.document||"string"!=typeof n.document.cookie)return null;for(var s=e+"=",r=n.document.cookie.split(";"),i=0,o=r.length;o>i;i++){var a=r[i];if(" "===a.charAt(0)&&(a=a.substring(1,a.length)),0===a.indexOf(s))return a.substring(s.length,a.length)}return null}};return e}),define("echo-4.0.3/util/cookie-policy",[],function(){function e(e){if("string"!=typeof e)return!1;var t=e.match(/(0|1){3}/);return null!==t}var t=function(t){this._cookiePolicy=e(t)?t:null};return t.prototype.getBBCMcCookie=function(){if(null===this._cookiePolicy)return"";var e="ad"+this._cookiePolicy.charAt(0)+"ps"+this._cookiePolicy.charAt(1)+"pf"+this._cookiePolicy.charAt(2);return e},t.prototype.getCknsCookie=function(){return null===this._cookiePolicy?"":this._cookiePolicy},t.prototype.hasOptedOutOfAdvertisingCookies=function(){return null===this._cookiePolicy?!1:"0"===this._cookiePolicy.charAt(0)},t.prototype.hasOptedOutOfFunctionalityCookies=function(){return null===this._cookiePolicy?!1:"0"===this._cookiePolicy.charAt(1)},t.prototype.hasOptedOutOfPerformanceCookies=function(){return null===this._cookiePolicy?!1:"0"===this._cookiePolicy.charAt(2)},t}),define("echo-4.0.3/environment",["require","./util/helper","./util/cookies","./util/cookie-policy"],function(e){function t(){var e=window.screen||{},t=window.navigator||{},n=window.document||{};this._platformRuntimeEnvironment="html",this._platformOSVersion="5",this._screenResolution=(e.width||"-")+"x"+(e.height||"-"),this._language=t.language||"",this._platformName=t.platform||"",this._charset=n.characterSet||n.defaultCharset||"",this._title=n.title||"",this._url=n.URL||"",this._referrer=n.referrer||"",this._deviceName=null,this._httpGet=null,this._getCookie=null,this._setCookie=null;var i=s.getCookieValueByName("ckns_policy");this._cookiePolicy=new r(i)}var n=e("./util/helper"),s=e("./util/cookies"),r=e("./util/cookie-policy");return t._defaultHttpGet=function(e,t){var n=new Image;"function"==typeof t&&(n.onload=function(){t()}),n.src=e},t._defaultGetCookie=function(e,t){return s.getCookieValueByName(e,t)},t.prototype.getCookiePolicy=function(){return this._cookiePolicy},t.prototype.getPlatformName=function(){return this._platformName},t.prototype.getPlatformRuntimeEnvironment=function(){return this._platformRuntimeEnvironment},t.prototype.getPlatformOSVersion=function(){return this._platformOSVersion},t.prototype.getDeviceName=function(){return this._deviceName},t.prototype.getScreenResolution=function(){return this._screenResolution},t.prototype.getLanguage=function(){return this._language},t.prototype.getHttpGet=function(){return this._httpGet},t.prototype.getCookieGetter=function(){return this._getCookie},t.prototype.getCookieSetter=function(){return this._setCookie},t.prototype.getCharSet=function(){return this._charset},t.prototype.getTitle=function(){return this._title},t.prototype.getURL=function(){return this._url},t.prototype.getReferrer=function(){return this._referrer},t.prototype.setPlatformName=function(e){return this._platformName=e,this},t.prototype.setPlatform=function(e,t){return this._platformRuntimeEnvironment=e,this._platformOSVersion=t,this},t.prototype.setDeviceName=function(e){return this._deviceName=e,this},t.prototype.setScreenResolution=function(e){return this._screenResolution=e,this},t.prototype.setLanguage=function(e){return this._language=n.cleanLangValue(e),this},t.prototype.setHttpGet=function(e){return this._httpGet=e,this},t.prototype.setCookieGetter=function(e){return this._getCookie=e,this},t.prototype.setCookieSetter=function(e){return this._setCookie=e,this},t.prototype.setCharSet=function(e){return this._charset=e,this},t.prototype.setTitle=function(e){return this._title=e,this},t.prototype.setURL=function(e){return this._url=e,this},t.prototype.setReferrer=function(e){return this._referrer=e,this},t}),define("echo-4.0.3/delegate/comscore/streamsense-bbc",[],function(){var e=e||{};return e.StreamSense=e.StreamSense||function(){function t(e,t){var n=new Image;n.src=e,t&&setTimeout(t,0)}function n(){throw new Error("comScore StreamSense viewNotify method should not be used")}function s(e,t){for(var n,s=2048,r=document,i=window,o=i.encodeURIComponent||escape,a=[],l=u.LABELS_ORDER,_=e.split("?"),c=_[0],p=_[1],d=p.split("&"),E=0,f=d.length;f>E;E++)if(d[E].length>0){var h=d[E].split("="),g=unescape(h[0]),m=unescape(h[1]);t[g]=m}for(var y={},E=0,f=l.length;f>E;E++){var v=l[E];t.hasOwnProperty(v)&&(y[v]=!0,a.push(o(v)+"="+o(t[v])))}for(var v in t)y[v]||t.hasOwnProperty(v)&&a.push(o(v)+"="+o(t[v]));return n=c+"?"+a.join("&"),n=n+(n.indexOf("&c8=")<0?"&c8="+o(r.title):"")+(n.indexOf("&c7=")<0?"&c7="+o(r.URL):"")+(n.indexOf("&c9=")<0?"&c9="+o(r.referrer):""),n.length>s&&n.indexOf("&")>0&&(last=n.substr(0,s-8).lastIndexOf("&"),n=(n.substring(0,last)+"&ns_cut="+o(n.substring(last+1))).substr(0,s)),n}var r=function(){var e={uid:function(){var e=1;return function(){return+new Date+"_"+e++}}(),filter:function(e,t){var n={};for(var s in t)t.hasOwnProperty(s)&&e(t[s])&&(n[s]=t[s]);return n},extend:function(e){var t,n=arguments.length;e=e||{};for(var s=1;n>s;s++)if(t=arguments[s])for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},getLong:function(e,t){var n=Number(e);return null==e||isNaN(n)?t||0:n},getInteger:function(e,t){var n=Number(e);return null==e||isNaN(n)?t||0:n},getBoolean:function(e,t){var n="true"==String(e).toLowerCase();return null==e?t||!1:n},isNotEmpty:function(e){return null!=e&&e.length>0},regionMatches:function(e,t,n,s,r){if(0>t||0>s||t+r>e.length||s+r>n.length)return!1;for(;--r>=0;){var i=e.charAt(t++),o=n.charAt(s++);if(i!=o)return!1}return!0}};return e.filterMap=function(e,t){for(var n in e)-1==t.indexOf(n)&&delete e[n]},e}(),i=function(){var e=["play","pause","end","buffer","keep-alive","hb","custom","ad_play","ad_pause","ad_end","ad_click"];return{PLAY:0,PAUSE:1,END:2,BUFFER:3,KEEP_ALIVE:4,HEART_BEAT:5,CUSTOM:6,AD_PLAY:7,AD_PAUSE:8,AD_END:9,AD_CLICK:10,toString:function(t){return e[t]}}}(),o=function(){var e=[i.END,i.PLAY,i.PAUSE,i.BUFFER];return{IDLE:0,PLAYING:1,PAUSED:2,BUFFERING:3,toEventType:function(t){return e[t]}}}(),a={ADPLAY:i.AD_PLAY,ADPAUSE:i.AD_PAUSE,ADEND:i.AD_END,ADCLICK:i.AD_CLICK},u={STREAMSENSE_VERSION:"4.1309.17",STREAMSENSEMEDIAPLAYER_VERSION:"4.1309.17",STREAMSENSEVIDEOVIEW_VERSION:"4.1309.17",DEFAULT_HEARTBEAT_INTERVAL:[{playingtime:6e4,interval:1e4},{playingtime:null,interval:6e4}],KEEP_ALIVE_PERIOD:12e5,PAUSED_ON_BUFFERING_PERIOD:500,PAUSE_PLAY_SWITCH_DELAY:500,DEFAULT_PLAYERNAME:"streamsense",C1_VALUE:"19",C10_VALUE:"js",NS_AP_C12M_VALUE:"1",NS_NC_VALUE:"1",PAGE_NAME_LABEL:"name",LABELS_ORDER:["c1","c2","ns_site","ns_vsite","ns_ap_an","ns_ap_pn","ns_ap_pv","c12","name","ns_ak","ns_ap_ec","ns_ap_ev","ns_ap_device","ns_ap_id","ns_ap_csf","ns_ap_bi","ns_ap_pfm","ns_ap_pfv","ns_ap_ver","ns_ap_sv","ns_type","ns_radio","ns_nc","ns_ap_ui","ns_ap_gs","ns_st_sv","ns_st_pv","ns_st_it","ns_st_id","ns_st_ec","ns_st_sp","ns_st_sq","ns_st_cn","ns_st_ev","ns_st_po","ns_st_cl","ns_st_el","ns_st_pb","ns_st_hc","ns_st_mp","ns_st_mv","ns_st_pn","ns_st_tp","ns_st_pt","ns_st_pa","ns_st_ad","ns_st_li","ns_st_ci","ns_ap_jb","ns_ap_res","ns_ap_c12m","ns_ap_install","ns_ap_updated","ns_ap_lastrun","ns_ap_cs","ns_ap_runs","ns_ap_usage","ns_ap_fg","ns_ap_ft","ns_ap_dft","ns_ap_bt","ns_ap_dbt","ns_ap_dit","ns_ap_as","ns_ap_das","ns_ap_it","ns_ap_uc","ns_ap_aus","ns_ap_daus","ns_ap_us","ns_ap_dus","ns_ap_ut","ns_ap_oc","ns_ap_uxc","ns_ap_uxs","ns_ap_lang","ns_ap_miss","ns_ts","ns_st_ca","ns_st_cp","ns_st_er","ns_st_pe","ns_st_ui","ns_st_bc","ns_st_bt","ns_st_bp","ns_st_pc","ns_st_pp","ns_st_br","ns_st_ub","ns_st_vo","ns_st_ws","ns_st_pl","ns_st_pr","ns_st_ep","ns_st_ty","ns_st_cs","ns_st_ge","ns_st_st","ns_st_dt","ns_st_ct","ns_st_de","ns_st_pu","ns_st_cu","ns_st_fee","c7","c8","c9"]},l=function(){var e=function(){function e(e,t){var s=t[e];null!=s&&(n[e]=s)}var t,n,s=this,a=0,u=0,l=0,_=0,c=0,p=0;r.extend(this,{reset:function(e){null!=e&&e.length>0?r.filterMap(n,e):n={},n.ns_st_cl="0",n.ns_st_pn="1",n.ns_st_tp="1",s.setClipId("1"),s.setPauses(0),s.setStarts(0),s.setBufferingTime(0),s.setBufferingTimestamp(-1),s.setPlaybackTime(0),s.setPlaybackTimestamp(-1)},setLabels:function(e,t){null!=e&&r.extend(n,e),s.setRegisters(n,t)},getLabels:function(){return n},setLabel:function(e,t){var n={};n[e]=t,s.setLabels(n,null)},getLabel:function(e){return n[e]},getClipId:function(){return t},setClipId:function(e){t=e},setRegisters:function(n,s){var r=n.ns_st_cn;null!=r&&(t=r,delete n.ns_st_cn),r=n.ns_st_bt,null!=r&&(l=Number(r),delete n.ns_st_bt),e("ns_st_cl",n),e("ns_st_pn",n),e("ns_st_tp",n),e("ns_st_ub",n),e("ns_st_br",n),(s==o.PLAYING||null==s)&&(r=n.ns_st_sq,null!=r&&(u=Number(r),delete n.ns_st_sq)),s!=o.BUFFERING&&(r=n.ns_st_pt,null!=r&&(c=Number(r),delete n.ns_st_pt)),(s==o.PAUSED||s==o.IDLE||null==s)&&(r=n.ns_st_pc,null!=r&&(a=Number(r),delete n.ns_st_pc))},createLabels:function(e,t){var n=t||{};return n.ns_st_cn=s.getClipId(),n.ns_st_bt=String(s.getBufferingTime()),(e==i.PLAY||null==e)&&(n.ns_st_sq=String(u)),(e==i.PAUSE||e==i.END||e==i.KEEP_ALIVE||e==i.HEART_BEAT||null==e)&&(n.ns_st_pt=String(s.getPlaybackTime()),n.ns_st_pc=String(a)),r.extend(n,s.getLabels()),n},incrementPauses:function(){a++},incrementStarts:function(){u++},getBufferingTime:function(){var e=l;return _>=0&&(e+=+new Date-_),e},setBufferingTime:function(e){l=e},getPlaybackTime:function(){var e=c;return p>=0&&(e+=+new Date-p),e},setPlaybackTime:function(e){c=e},getPlaybackTimestamp:function(){return p},setPlaybackTimestamp:function(e){p=e},getBufferingTimestamp:function(){return _},setBufferingTimestamp:function(e){_=e},getPauses:function(){return a},setPauses:function(e){a=e},getStarts:function(){return u},setStarts:function(e){u=e}}),n={},s.reset()};return e}(),_=function(){var e=function(){var e,t,n=this,s=null,a=0,u=0,_=0,c=0,p=0,d=0,E=!1;r.extend(this,{reset:function(e){null!=e&&e.length>0?r.filterMap(t,e):t={},n.setPlaylistId(+new Date+"_"+d),n.setBufferingTime(0),n.setPlaybackTime(0),n.setPauses(0),n.setStarts(0),n.setRebufferCount(0),E=!1},setLabels:function(e,s){null!=e&&r.extend(t,e),n.setRegisters(t,s)},getLabels:function(){return t},setLabel:function(e,t){var s={};s[e]=t,n.setLabels(s,null)},getLabel:function(e){return t[e]},getClip:function(){return s},getPlaylistId:function(){return e},setPlaylistId:function(t){e=t},setRegisters:function(t,n){var s=t.ns_st_sp;null!=s&&(a=Number(s),delete t.ns_st_sp),s=t.ns_st_bc,null!=s&&(_=Number(s),delete t.ns_st_bc),s=t.ns_st_bp,null!=s&&(c=Number(s),delete t.ns_st_bp),s=t.ns_st_id,null!=s&&(e=s,delete t.ns_st_id),n!=o.BUFFERING&&(s=t.ns_st_pa,null!=s&&(p=Number(s),delete t.ns_st_pa)),(n==o.PAUSED||n==o.IDLE||null==n)&&(s=t.ns_st_pp,null!=s&&(u=Number(s),delete t.ns_st_pp))},createLabels:function(t,s){var o=s||{};return o.ns_st_bp=String(n.getBufferingTime()),o.ns_st_sp=String(a),o.ns_st_id=String(e),_>0&&(o.ns_st_bc=String(_)),(t==i.PAUSE||t==i.END||t==i.KEEP_ALIVE||t==i.HEART_BEAT||null==t)&&(o.ns_st_pa=String(n.getPlaybackTime()),o.ns_st_pp=String(u)),(t==i.PLAY||null==t)&&(n.didFirstPlayOccurred()||(o.ns_st_pb="1",n.setFirstPlayOccurred(!0))),r.extend(o,n.getLabels()),o},incrementStarts:function(){a++},incrementPauses:function(){u++,s.incrementPauses()},setPlaylistCounter:function(e){d=e},incrementPlaylistCounter:function(){d++},addPlaybackTime:function(e){if(s.getPlaybackTimestamp()>=0){var t=e-s.getPlaybackTimestamp();s.setPlaybackTimestamp(-1),s.setPlaybackTime(s.getPlaybackTime()+t),n.setPlaybackTime(n.getPlaybackTime()+t)}},addBufferingTime:function(e){if(s.getBufferingTimestamp()>=0){var t=e-s.getBufferingTimestamp();s.setBufferingTimestamp(-1),s.setBufferingTime(s.getBufferingTime()+t),n.setBufferingTime(n.getBufferingTime()+t)}},getBufferingTime:function(){var e=c;return s.getBufferingTimestamp()>=0&&(e+=+new Date-s.getBufferingTimestamp()),e},setBufferingTime:function(e){c=e},getPlaybackTime:function(){var e=p;return s.getPlaybackTimestamp()>=0&&(e+=+new Date-s.getPlaybackTimestamp()),e},setPlaybackTime:function(e){p=e},getStarts:function(){return a},setStarts:function(e){a=e},getPauses:function(){return u},setPauses:function(e){u=e},getRebufferCount:function(){return _},incrementRebufferCount:function(){_++},setRebufferCount:function(e){_=e},didFirstPlayOccurred:function(){return E},setFirstPlayOccurred:function(e){E=e}}),s=new l,t={},n.reset()};return e}(),c=function(){var a=function(a,l){function c(e){var t=0;if(null!=_t)for(var n=0;n<_t.length;n++){var s=_t[n],r=s.playingtime;if(!r||r>e){t=s.interval;break}}return t}function p(){h();var e=c(at.getClip().getPlaybackTime());if(e>0){var t=ct>0?ct:e;J=setTimeout(f,t)}ct=0}function d(){h();var e=c(at.getClip().getPlaybackTime());ct=e-at.getClip().getPlaybackTime()%e,null!=J&&h()}function E(){ct=0,dt=0,pt=0}function f(){pt++;var e=H(i.HEART_BEAT,null);T(e),ct=0,p()}function h(){null!=J&&(clearTimeout(J),J=null)}function g(){y(),z=setTimeout(m,u.KEEP_ALIVE_PERIOD)}function m(){var e=H(i.KEEP_ALIVE,null);T(e),ot++,g()}function y(){null!=z&&(clearTimeout(z),z=null)}function v(){b(),nt.isPauseOnBufferingEnabled()&&M(o.PAUSED)&&(K=setTimeout(A,u.PAUSED_ON_BUFFERING_PERIOD))}function A(){if(X==o.PLAYING){at.incrementRebufferCount(),at.incrementPauses();var e=H(i.PAUSE,null);T(e),ot++,X=o.PAUSED}}function b(){null!=K&&(clearTimeout(K),K=null)}function I(){null!=$&&(clearTimeout($),$=null)}function P(e){return e==o.PLAYING||e==o.PAUSED}function L(e){return e==i.PLAY?o.PLAYING:e==i.PAUSE?o.PAUSED:e==i.BUFFER?o.BUFFERING:e==i.END?o.IDLE:null}function S(e,t,n){if(I(),w(e))if(n)setTimeout(function(){S(e,t)},n);else{var s=k(),i=rt,a=U(t),u=i>=0?a-i:0;D(k(),t),O(e,t),V(e);for(var l=0,_=tt.length;_>l;l++)tt[l](s,e,t,u);C(t),at.setRegisters(t,e),at.getClip().setRegisters(t,e);var c=H(o.toEventType(e),t);r.extend(c,t),M(q)&&(T(c),X=q,ot++)}}function C(e){var t=e.ns_st_mp;null!=t&&(Z=t,delete e.ns_st_mp),t=e.ns_st_mv,null!=t&&(Q=t,delete e.ns_st_mv),t=e.ns_st_ec,null!=t&&(ot=Number(t),delete e.ns_st_ec)}function T(e,n){void 0===n&&(n=!0),n&&R(e);var r=nt.getPixelURL();if(j){if(!N()){var i=ft.am,o=ft.et,a=i.newApplicationMeasurement(j,o.HIDDEN,e,r);j.getQueue().offer(a)}}else r&&t(s(r,e))}function N(){var e=j.getAppContext(),t=j.getSalt(),n=j.getPixelURL();return null==e||null==t||0==t.length||null==n||0==n.length}function R(e){et=H(null),r.extend(et,e)}function D(e,t){var n=U(t);e==o.PLAYING?(at.addPlaybackTime(n),d(),y()):e==o.BUFFERING&&(at.addBufferingTime(n),b())}function O(e,t){var n=U(t),s=B(t);it=s,e==o.PLAYING?(p(),g(),at.getClip().setPlaybackTimestamp(n),M(e)&&(at.getClip().incrementStarts(),at.getStarts()<1&&at.setStarts(1))):e==o.PAUSED?M(e)&&at.incrementPauses():e==o.BUFFERING?(at.getClip().setBufferingTimestamp(n),lt&&v()):e==o.IDLE&&E()}function M(e){return e!=o.PAUSED||X!=o.IDLE&&null!=X?e!=o.BUFFERING&&X!=e:!1}function B(e){var t=-1;return e.hasOwnProperty("ns_st_po")&&(t=Number(e.ns_st_po)),t}function U(e){var t=-1;return e.hasOwnProperty("ns_ts")&&(t=Number(e.ns_ts)),t}function w(e){return null!=e&&k()!=e}function V(e){q=e,rt=+new Date}function k(){return q}function H(){var e,t;1==arguments.length?(e=o.toEventType(q),t=arguments[0]):(e=arguments[0],t=arguments[1]);var n={};return null!=t&&r.extend(n,t),n.hasOwnProperty("ns_ts")||(n.ns_ts=String(+new Date)),null==e||n.hasOwnProperty("ns_st_ev")||(n.ns_st_ev=i.toString(e)),nt.isPersistentLabelsShared()&&j&&r.extend(n,j.getLabels()),r.extend(n,nt.getLabels()),G(e,n),at.createLabels(e,n),at.getClip().createLabels(e,n),n.hasOwnProperty("ns_st_mp")||(n.ns_st_mp=Z),n.hasOwnProperty("ns_st_mv")||(n.ns_st_mv=Q),n.hasOwnProperty("ns_st_ub")||(n.ns_st_ub="0"),n.hasOwnProperty("ns_st_br")||(n.ns_st_br="0"),n.hasOwnProperty("ns_st_pn")||(n.ns_st_pn="1"),n.hasOwnProperty("ns_st_tp")||(n.ns_st_tp="1"),n.hasOwnProperty("ns_st_it")||(n.ns_st_it="c"),n.ns_st_sv=u.STREAMSENSE_VERSION,n.ns_type="hidden",n}function G(e,t){var n=t||{};if(n.ns_st_ec=String(ot),!n.hasOwnProperty("ns_st_po")){var s=it,r=U(n);(e==i.PLAY||e==i.KEEP_ALIVE||e==i.HEART_BEAT||null==e&&q==o.PLAYING)&&(s+=r-at.getClip().getPlaybackTimestamp()),n.ns_st_po=String(s)}return e==i.HEART_BEAT&&(n.ns_st_hc=String(pt)),n}function F(e){var t=U(e);0>t&&(e.ns_ts=String(+new Date))}function x(e,t,n){t=t||{},t.ns_st_ad=1,e>=i.AD_PLAY&&e<=i.AD_CLICK&&nt.notify(e,t,n)}function Y(e,t){nt.notify(i.CUSTOM,e,t)}var W,q,j,K,z,$,J,X,Z,Q,et,tt,nt=this,st=null,rt=0,it=0,ot=0,at=null,ut=!0,lt=!0,_t=u.DEFAULT_HEARTBEAT_INTERVAL,ct=0,pt=0,dt=0,Et=!1,ft={};r.extend(this,{reset:function(e){at.reset(e),at.setPlaylistCounter(0),at.setPlaylistId(+new Date+"_1"),at.getClip().reset(e),null==e||e.isEmpty()?W={}:r.filterMap(W,e),ot=1,pt=0,d(),E(),y(),b(),I(),q=o.IDLE,rt=-1,X=null,Z=u.DEFAULT_PLAYERNAME,Q=u.STREAMSENSE_VERSION,et=null},notify:function(){var e,t,n,s;t=arguments[0],3==arguments.length?(n=arguments[1],s=arguments[2]):(n={},s=arguments[1]),e=L(t);var o=r.extend({},n);if(F(o),o.hasOwnProperty("ns_st_po")||(o.ns_st_po=String(s)),t==i.PLAY||t==i.PAUSE||t==i.BUFFER||t==i.END)nt.isPausePlaySwitchDelayEnabled()&&w(e)&&P(q)&&P(e)?S(e,o,u.PAUSE_PLAY_SWITCH_DELAY):S(e,o);else{var a=H(t,o);r.extend(a,o),T(a,!1),ot++}},getLabels:function(){return W},setLabels:function(e){null!=e&&(null==W?W=e:r.extend(W,e))},getLabel:function(e){return W[e]},setLabel:function(e,t){null==t?delete W[e]:W[e]=t},setPixelURL:function(e){if(null==e||0==e.length)return null;var t=e.indexOf("?");if(t>=0){if(t<e.length-1){for(var n=e.substring(t+1).split("&"),s=0,r=n.length;r>s;s++){var i=n[s],o=i.split("=");2==o.length?nt.setLabel(o[0],o[1]):1==o.length&&nt.setLabel(u.PAGE_NAME_LABEL,o[0])}e=e.substring(0,t+1)}}else e+="?";return st=e},getPixelURL:function(){return st?st:"undefined"!=typeof ns_p&&"string"==typeof ns_p.src?st=ns_p.src.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):"string"==typeof ns_pixelUrl?st.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):null},isPersistentLabelsShared:function(){return ut},setPersistentLabelsShared:function(e){ut=e},isPauseOnBufferingEnabled:function(){return lt},setPauseOnBufferingEnabled:function(e){lt=e},isPausePlaySwitchDelayEnabled:function(){return Et},setPausePlaySwitchDelayEnabled:function(e){Et=e},setClip:function(e,t){q==o.IDLE&&(at.getClip().reset(),at.getClip().setLabels(e,null),t&&at.incrementStarts())},setPlaylist:function(e){q==o.IDLE&&(at.incrementPlaylistCounter(),at.reset(),at.getClip().reset(),at.setLabels(e,null))},importState:function(e){reset();var t=r.extend({},e);at.setRegisters(t,null),at.getClip().setRegisters(t,null),C(t),ot++},exportState:function(){return et},getVersion:function(){return u.STREAMSENSE_VERSION},addListener:function(e){tt.push(e)},removeListener:function(e){tt.splice(tt.indexOf(e),1)},getClip:function(){return at.getClip()},getPlaylist:function(){return at}}),r.extend(this,{adNotify:x,customNotify:Y,viewNotify:function(e,t){e=e||nt.getPixelURL(),e&&n(e,t)}}),e.comScore&&(ft=e.comScore.exports,j=ft.c()),W={},ot=1,q=o.IDLE,at=new _,K=null,lt=!0,J=null,pt=0,E(),z=null,$=null,Et=!1,X=null,it=0,tt=[],nt.reset(),a&&nt.setLabels(a),l&&nt.setPixelURL(l)};return function(t){function n(e,t){return I[L]||i(e,t)}function s(){L=-1;for(var t=0;P>=t;t++)if(I.hasOwnProperty(t)){L=t;break}return e.StreamSense.activeIndex=L,L}function i(t,n){return t=t||null,n=n||null,t&&"object"==typeof t&&(n=t,t=null),I[++P]=new e.StreamSense(n,t),s(),I[P]}function o(){var t=!1,n=L;if("number"==typeof arguments[0]&&isFinite(arguments[0]))n=arguments[0];else if(arguments[0]instanceof e.StreamSense)for(var r in I)if(I[r]===arguments[0]){n=r;break}return I.hasOwnProperty(n)&&(t=I[n],delete I[n],t.reset(),s()),t}function a(e){return e=e||{},n().setPlaylist(e),n().getPlaylist()}function u(e,t,s){return e=e||{},"number"==typeof t&&(e.ns_st_cn=t),n().setClip(e,s),n().getClip()}function l(e,t,s){return"undefined"==typeof e?!1:(s=s||null,t=t||{},n().notify(e,t,s))}function _(e){"undefined"!=typeof e&&n().setLabels(e)}function c(){return n().getLabels()}function p(e){"undefined"!=typeof e&&n().getPlaylist().setLabels(e)}function d(){return n().getPlaylist().getLabels()}function E(e){"undefined"!=typeof e&&n().getClip().setLabels(e)}function f(){return n().getClip().getLabels()}function h(e){return n().reset(e||{})}function g(e){return n().getPlaylist().reset(e||{})}function m(e){return n().getClip().reset(e||{})}function y(e){return e=e||{},n().viewNotify(null,e)}function v(e,t){return arguments.length>2&&(e=arguments[1],t=arguments[2]),e=e||{},"number"==typeof t&&(e.ns_st_po=t),n().customNotify(e,t)}function A(){return n().exportState()}function b(e){n().importState(e)}var I={},P=-1,L=-1;r.extend(t,{activeIndex:L,newInstance:i,"new":i,destroyInstance:o,destroy:o,newPlaylist:a,newClip:u,notify:l,setLabels:_,getLabels:c,setPlaylistLabels:p,getPlaylistLabels:d,setClipLabels:E,getClipLabels:f,resetInstance:h,resetPlaylist:g,resetClip:m,viewEvent:y,customEvent:v,exportState:A,importState:b})}(a),a}();return c.AdEvents=a,c.PlayerEvents=i,c._BBCSetHttpGet=function(e){t=e},c}(),e.StreamSense}),define("echo-4.0.3/delegate/comscore/app-tag",[],function(){function e(t,n,s){this._persistantLabels={},this._url=e._makeBaseUrl(t),this._urlParams="",this._cut="",this._httpGet=n,this._eventCount=0,this._isApp=s}return e.URL_LIMIT=2048,e.prototype.addLabels=function(e){for(var t in e)this._persistantLabels[t]=e[t]},e.prototype.addLabel=function(e,t){this._persistantLabels[e]=t},e.prototype.removeLabels=function(e){for(var t in e)"undefined"!=typeof this._persistantLabels[e[t]]&&delete this._persistantLabels[e[t]]},e.prototype.send=function(e,t,n){var s,r,i=this._persistantLabels,o={};this._eventCount++;for(r in i)o[r]=i[r];for(r in t)o[r]=t[r];o.ns_type=e,this._isApp&&(o.ns_ap_ev=e,o.ns_ap_ec=this._eventCount),o[this._isApp?"ns_ts":"ns__t"]=+new Date,s=this._createUrl(o),this._httpGet(s,n)},e.prototype._createUrl=function(e){var t,n=window.encodeURIComponent||escape,s=this._url;this._urlParams="",this._cut="",e.hasOwnProperty("name")&&this._addUrlParam("name",e.name);for(t in e)"name"!==t&&"ns_referrer"!==t&&this._addUrlParam(t,e[t]);return e.hasOwnProperty("ns_referrer")&&this._addUrlParam("ns_referrer",e.ns_referrer),s+=this._urlParams,this._cut.length?s+="ns_cut="+n(this._cut.replace(/&$/,"")):s=s.replace(/&$/,""),s},e.prototype._addUrlParam=function(t,n){var s=window.encodeURIComponent||escape,r=s(t)+"="+s(n)+"&",i=e.URL_LIMIT-8;this._url.length+this._urlParams.length+r.length<i?this._urlParams+=r:this._cut+=r},e._makeBaseUrl=function(e){for(var t=-1,n=e.charAt(e.length-1),s=0,r=e.length;r>s;s++)"?"===e.charAt(s)&&(t=s);return-1===t?e+="?":"?"!==n&&"&"!==n&&(e+="&"),e},e}),define("echo-4.0.3/delegate/comscore/comscore-delegate",["require","./label-keys","../../config/keys","../../environment","../../util/methods","../../enumerations","./streamsense-bbc","./app-tag"],function(e){function t(){return-1}function n(e,t,a,l){this.SSPlayerEvent=n.StreamSense.PlayerEvents;var _=l.getHttpGet();_&&n.StreamSense._BBCSetHttpGet(_);var c=a[r.COMSCORE_URL];this._isApp=!o.containsValue(u,t),this.appTag=new n.AppTag(c,_||i._defaultHttpGet,this._isApp),this.ss=new n.StreamSense({},c),this.addLabel(s.BBC_APPLICATION_NAME,e),this.addLabel(s.BBC_APPLICATION_TYPE,t),this.addLabel(s.BBC_MEASUREMENT_LIB_NAME,a[r.ECHO_NAME]),this.addLabel(s.BBC_MEASUREMENT_LIB_VERSION,a[r.ECHO_VERSION]),this._isApp?(this.addLabel(s.APP_NAME,e),this.addLabel(s.APP_PLATFORM_NAME,l.getPlatformName()),this.addLabel(s.APP_PLATFORM_RUNTIME,l.getPlatformRuntimeEnvironment()),this.addLabel(s.APP_OS_VERSION,l.getPlatformOSVersion()),this.addLabel(s.APP_DEVICE_NAME,l.getDeviceName()),this.addLabel(s.APP_SCREEN_RESOLUTION,l.getScreenResolution()),this.addLabel(s.APP_LANGUAGE,l.getLanguage())):this.addLabel(s.WEB_SCREEN_RES,l.getScreenResolution()),this.addLabel(s.ENV_CHAR_SET,l.getCharSet()),this.addLabel(s.ENV_TITLE,l.getTitle()),this.addLabel(s.ENV_URL,l.getURL()),this.addLabel(s.ENV_REFERRER,l.getReferrer()),a[r.ECHO_TRACE]&&this.addLabel(s.ECHO_TRACE,a[r.ECHO_TRACE]),a[r.COMSCORE_SITE]&&this.addLabel(s.COMSCORE_SITE,a[r.COMSCORE_SITE]);
var p=l.getCookiePolicy(),d=p.getBBCMcCookie();d.length>0&&(this.addLabel(s.COOKIE_POLICY,d),p.hasOptedOutOfPerformanceCookies()&&this.addLabel(s.NO_COOKIES,"1")),this._mediaIsLive=null}var s=e("./label-keys"),r=e("../../config/keys"),i=e("../../environment"),o=e("../../util/methods"),a=e("../../enumerations"),u=[a.ApplicationType.WEB,a.ApplicationType.MOBILE_WEB,a.ApplicationType.RESPONSIVE];return n.StreamSense=e("./streamsense-bbc"),n.AppTag=e("./app-tag"),n.prototype.addLabels=function(e){this.appTag.addLabels(e),this.ss.setLabels(e)},n.prototype.addLabel=function(e,t){this.appTag.addLabel(e,t),this.ss.setLabel(e,t)},n.prototype.removeLabels=function(e){this.appTag.removeLabels(e);for(var t in e)this.ss.setLabel(e[t],null)},n.prototype.removeLabel=function(e){this.appTag.removeLabels([e]),this.ss.setLabel(e,null)},n.prototype.setIsLoggedInToBBCId=function(e){e===!0&&this.addLabel(s.BBC_ID_LOGGED_IN,"1"),e===!1&&this.removeLabel(s.BBC_ID_LOGGED_IN)},n.prototype.setAppVersion=function(e){this._isApp&&this.addLabel(s.APP_VERSION,e)},n.prototype.setCounterName=function(e){this.addLabel(s.BBC_COUNTER_NAME,e)},n.prototype.setContentLanguage=function(e){this.addLabel(s.BBC_LANGUAGE,e)},n.prototype.setDeviceID=function(e){this.addLabel(s.DEVICE_ID,e)},n.prototype.viewEvent=function(e,t){this.addLabel(s.BBC_COUNTER_NAME,e);var n=o.extend(t,!0,s.ECHO_EVENT_NAME,"view");this.appTag.send("view",n)},n.prototype.errorEvent=t,n.prototype.userActionEvent=function(e,t,n){var r=o.extend(n,!0,s.USER_ACTION_TYPE,e,s.USER_ACTION_NAME,t,s.ECHO_EVENT_NAME,"userAct");this.appTag.send("hidden",r)},n.prototype.setPlayerName=function(e){this.addLabel(s.PLAYER_NAME,e)},n.prototype.setPlayerVersion=function(e){this.addLabel(s.PLAYER_VERSION,e)},n.prototype.setPlayerIsPopped=function(e){this.ss.setLabel(s.PLAYER_POPPED,e?1:0)},n.prototype.setPlayerWindowState=function(e){this.ss.setLabel(s.PLAYER_WINDOW_STATE,e)},n.prototype.setPlayerVolume=function(e){this.ss.setLabel(s.PLAYER_VOLUME,e)},n.prototype.setPlayerIsSubtitled=function(e){this.ss.setLabel(s.PLAYER_SUBTITLED,e?1:0)},n.prototype.setPlayerSize=t,n.prototype.setPlayerPositionGetter=t,n.prototype.setMedia=function(e){var t={},n={},r=e.getCodec(),i=e.getCDN();switch(t[s.PLAYLIST_NAME]=e.getContentId(),t[s.PLAYLIST_CLIP_COUNT]=1,t[s.PLAYLIST_LENGTH]=e.getLength(),this.ss.setPlaylist(t),n[s.MEDIA_CLIP_NUMBER]=1,n[s.MEDIA_PART_NUMBER]=1,n[s.MEDIA_TOTAL_PARTS]=1,n[s.MEDIA_LENGTH]=e.getLength(),n[s.MEDIA_MEDIUM]=e.getAvType(),n[s.MEDIA_FORM]=e.getForm(),n[s.MEDIA_RETRIEVAL_TYPE]=e.getRetrievalType(),n[s.MEDIA_BITRATE]=1e3*e.getBitrate(),null!==r&&(n[s.MEDIA_CODEC]=r),null!==i&&(n[s.MEDIA_CDN]=i),n[s.MEDIA_PID]=e.getContentId(),n[s.MEDIA_VERSION_ID]=e.getVersionId(),e.getServiceId()&&(n[s.MEDIA_SERVICE_ID]=e.getServiceId()),e.getScheduleMode()){case a.EchoScheduleMode.ON:n[s.MEDIA_SCHEDULE_INDICATOR]="on";break;case a.EchoScheduleMode.OFF:n[s.MEDIA_SCHEDULE_INDICATOR]="off"}n[s[e.isEpisode()?"MEDIA_EPISODE_ID":"MEDIA_CLIP_ID"]]=e.getContentId(),e.isOnDemand()?(n[s.MEDIA_STREAM_TYPE]=e.isVideo()?"vod":"aod",n[s.MEDIA_LIVE_OR_ONDEMAND]="on-demand",this._mediaIsLive=!1):(n[s.MEDIA_STREAM_TYPE]="live",n[s.MEDIA_IS_LIVE]=1,n[s.MEDIA_LIVE_OR_ONDEMAND]="live",this._mediaIsLive=!0),this.ss.setClip(n)},n.prototype.setMediaLength=function(e){this.ss.getPlaylist().setLabel(s.PLAYLIST_LENGTH,e),this.ss.getClip().setLabel(s.MEDIA_LENGTH,e)},n.prototype.setMediaBitrate=function(e){e*=1e3,this.ss.getClip().setLabel(s.MEDIA_BITRATE,e)},n.prototype.avPlayEvent=function(e,t){var n=o.extend(t,!0,s.ECHO_EVENT_NAME,"avPlay");this.ss.notify(this.SSPlayerEvent.PLAY,n,this._mediaIsLive?0:e)},n.prototype.avPauseEvent=function(e,t){var n=o.extend(t,!0,s.ECHO_EVENT_NAME,"avPause");this.ss.notify(this.SSPlayerEvent.PAUSE,n,this._mediaIsLive?0:e)},n.prototype.avBufferEvent=function(e){this.ss.notify(this.SSPlayerEvent.BUFFER,{},this._mediaIsLive?0:e)},n.prototype.avEndEvent=function(e,t){var n=o.extend(t,!0,s.ECHO_EVENT_NAME,"avEnd",s.PLAYLIST_END,1);this.ss.notify(this.SSPlayerEvent.END,n,this._mediaIsLive?0:e)},n.prototype.avRewindEvent=function(e,t,n){var r=o.extend(n,!0,s.ECHO_EVENT_NAME,"avRW",s.EVENT_TRIGGERED_BY_USER,"rewind",s.REWIND_FF_RATE,t);this.ss.notify(this.SSPlayerEvent.PAUSE,r,this._mediaIsLive?0:e)},n.prototype.avFastForwardEvent=function(e,t,n){var r=o.extend(n,!0,s.ECHO_EVENT_NAME,"avFF",s.EVENT_TRIGGERED_BY_USER,"fastforward",s.REWIND_FF_RATE,t);this.ss.notify(this.SSPlayerEvent.PAUSE,r,this._mediaIsLive?0:e)},n.prototype.avSeekEvent=function(e,t){var n=o.extend(t,!0,s.ECHO_EVENT_NAME,"avSeek",s.EVENT_TRIGGERED_BY_USER,"seek");this.ss.notify(this.SSPlayerEvent.PAUSE,n,this._mediaIsLive?0:e)},n.prototype.avUserActionEvent=function(e,t,n,r){var i=o.extend(r,!0,s.ECHO_EVENT_NAME,"avUserAct",s.STREAMSENSE_CUSTOM_EVENT_TYPE,e,s.USER_ACTION_TYPE,e,s.USER_ACTION_NAME,t);this.ss.customNotify(i,this._mediaIsLive?0:n)},n}),define("echo-4.0.3/delegate/rum/label-keys",{COUNTERNAME:"cn",USER_ACTION_TYPE:"uat",USER_ACTION_NAME:"uan",USER_ACTION_EVENT:"UA",MEDIA_PID:"pid",MEDIA_TYPE:"mt",MEDIA_ON_DEMAND:"od",MEDIA_RETRIEVAL_TYPE:"ret",MEDIA_LENGTH:"len",MEDIA_BITRATE:"br",MEDIA_CDN:"cdn",MEDIA_POSITION:"pos",AV_PLAY_EVENT:"AVPL",AV_PAUSE_EVENT:"AVPS",AV_BUFFER_EVENT:"AVBF",AV_END_EVENT:"AVEN",AV_FF_EVENT:"AVFF",AV_RW_EVENT:"AVRW",AV_SEEK_EVENT:"AVSK",AV_UA_EVENT:"AVUA",ECHO_TRACE:"trace"}),define("lib/json",["require"],function(){var e={};return function(){function t(e){return 10>e?"0"+e:e}function n(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,function(e){var t=a[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function s(e,t){var o,a,u,l,_,c=r,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),typeof p){case"string":return n(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(r+=i,_=[],"[object Array]"===Object.prototype.toString.apply(p)){for(l=p.length,o=0;l>o;o+=1)_[o]=s(o,p)||"null";return u=0===_.length?"[]":r?"[\n"+r+_.join(",\n"+r)+"\n"+c+"]":"["+_.join(",")+"]",r=c,u}for(a in p)Object.prototype.hasOwnProperty.call(p,a)&&(u=s(a,p),u&&_.push(n(a)+(r?": ":":")+u));return u=0===_.length?"{}":r?"{\n"+r+_.join(",\n"+r)+"\n"+c+"}":"{"+_.join(",")+"}",r=c,u}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var r,i,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};"function"!=typeof e.stringify&&(e.stringify=function(e){return s("",{"":e})})}(),e}),define("analytics_client",["require","./lib/json"],function(e){function t(n){this.events=[],this.labels={},this.dataLabels={},this._getCookie=n.custom_cookie_getter||this._getCookie,this.p=n.product||"_",this.e=n.edition||null,this.id2=this._getCookie(t.USER_COOKIE_NAME),this.posting=this._setDelivery(n.delivery_method,n.server,n.url_params,n.custom_delivery),this.limit_url=!this.posting,this.JSON=window.JSON||e("./lib/json")}return t.USER_COOKIE_NAME="s1",t.MAX_URL_LENGTH=2e3,t.RT_THRESHOLD=6e4,t.AJAX_POST=1,t.AJAX_GET=2,t.DOM_GET=3,t.CUSTOM_POST=4,t.CUSTOM_GET=5,t.LABELS={COUNT_CONTENT_ID:"ccid",COUNT_LIST_ID:"clid"},t.VERSION="0.4.5",t.prototype._setDelivery=function(e,n,s,r){var i,o,a;switch(e){case t.AJAX_POST:i=!0,o=!0,a=!1;break;case t.AJAX_GET:i=!1,o=!0,a=!1;break;case t.DOM_GET:i=!1,o=!1,a=!1;break;case t.CUSTOM_POST:i=!0,o=!1,a=!0;break;case t.CUSTOM_GET:i=!1,o=!1,a=!0;break;default:i=!0,o=!0,a=!1}return i&&"object"==typeof navigator&&navigator.platform&&(-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPod")||-1!=navigator.platform.indexOf("iPad"))&&(i=!1),a?this._makeRequest=t._useCustomRequest(r,t._makeURL(i,n,s),i):o&&"undefined"!=typeof XMLHttpRequest&&"undefined"!=typeof(new XMLHttpRequest).withCredentials?this._makeRequest=t._useXMLHttpRequest(t._makeURL(i,n,s),i):(i=!1,this._makeRequest=t._useImageRequest(t._makeURL(!1,n,s))),i},t._makeURL=function(e,n,s){var r=e?"":"/legacy",i=n+r;return s?t._addParams(i,s):i},t._addParams=function(e,t){-1===e.indexOf("?")?e+="?":e.indexOf("?")!==e.length-1&&(e+="&");for(var n in t)e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n])+"&";return e.replace(/(\?|&)$/,"")},t.prototype._addEvent=function(e,n,s){var r,i,o={},a={};for(r in this.dataLabels)o[r]=this.dataLabels[r];for(r in n)o[r]=n[r];for(r in this.labels)a[r]=this.labels[r];for(r in s)r===t.LABELS.COUNT_CONTENT_ID||r===t.LABELS.COUNT_LIST_ID?o[r]=s[r]:a[r]=s[r];i={cv:t.VERSION,p:this.p,id:e,id2:this.id2,ts:(new Date).getTime(),l:a,data:o},null!==this.e&&(i.e=this.e),this.events.push(i)},t.prototype._getCookie=function(e){if("undefined"==typeof document||"string"!=typeof document.cookie)return null;var t,n=document.cookie;if(0===n.indexOf(e+"="))t=e.length+1;else{if(t=n.indexOf(" "+e+"="),-1==t)return null;t+=e.length+2}var s=n.indexOf(";",t);return-1==s&&(s=n.length),n.substring(t,s)},t.prototype._addEventAndSend=function(e,t,n,s){this._addEvent(e,t,n),this._sendEvents(s)},t._createPLData=function(){return{url:window.location.pathname,referrer:document.referrer}},t._createPTData=function(){if("object"!=typeof window.performance)return null;var e={url:window.location.pathname};for(var t in window.performance.timing)"function"!=typeof window.performance.timing[t]&&(e[t]=window.performance.timing[t]);e.navigationStart=e.navigationStart||e.redirectStart||e.fetchStart;var n=e.loadEventEnd,s=e.navigationStart,r=e.requestStart,i=e.responseEnd;return n&&s&&r&&i&&(e.plt=n-s,e.pre=r-s,e.req=i-r,e.pro=n-i),e},t._createRTData=function(e,n){if(window.performance&&window.performance.getEntriesByType){var s=t._cleanRTData(window.performance.getEntriesByType("resource"));return{url:window.location.pathname,plt:e,"long":n,res:s}}return null},t._cleanRTData=function(e){for(var t=[],n=0,s=e.length;s>n;n++){t[n]={};for(var r in e[n])0!==e[n][r]&&(t[n][r]="name"===r?e[n][r].replace(/\?.*$/,""):e[n][r])}return t},t.prototype._sendEvents=function(e,n){var s,r,i=n;if(i||(i=this.events,this.events=[]),s=this.JSON.stringify({events:i}),this.limit_url&&i.length>1&&s.length>t.MAX_URL_LENGTH)for(r=0;r<i.length;r++)this._sendEvents(e,[i[r]]);else this._makeRequest(e,s,{"Content-type":"application/json"})},t._useXMLHttpRequest=function(e,n){return function(s,r,i){var o,a=e;n||(a=t._addParams(a,{data:r})),o=new XMLHttpRequest,o.open(n?"POST":"GET",a,!0);for(var u in i)o.setRequestHeader(u,i[u]);o.onreadystatechange=function(){4==o.readyState&&s&&s(o.status)};try{o.send(r)}catch(l){}}},t._useImageRequest=function(e){function n(e,t){i.push(function(){var n=new Image;n.onload=function(){s(),"function"==typeof e&&e()},n.onerror=function(){s()},n.onabort=function(){s()},n.src=t}),r()}function s(){o=!1,r()}function r(){if(!(o||i.length<1)){o=!0;var e=i.shift();e()}}var i=[],o=!1;return function(s,r){var i=t._addParams(e,{data:r});n(s,i)}},t._useCustomRequest=function(e,n,s){return s?function(t,s,r){e(t,null,"POST",n,r,s)}:function(s,r,i){e(s,null,"GET",t._addParams(n,{data:r}),i)}},t.prototype.load=function(e,n){var s=this;s._addEvent("PL",t._createPLData(),e),setTimeout(function(){var r,i,o,a=t._createPTData();a&&(s._addEvent("PT",a,e),n!==!1&&(i=a.plt,o=a.plt>t.RT_THRESHOLD,(n||o)&&(r=t._createRTData(a.plt,o),r&&(s.rtSent=!0,s._addEvent("RT",r,e))))),s._sendEvents()},0)},t.prototype.sendError=function(e,t,n,s){this._addEventAndSend("ERR",{m:e,file:t,line:n},s)},t.prototype.sendExit=function(e,t,n){this._addEventAndSend("EXIT",{s:e,d:t},n)},t.prototype.addLabels=function(e,t){for(var n in e)this.addLabel(n,e[n],t)},t.prototype.addLabel=function(e,t,n){this[n?"dataLabels":"labels"][e]=t},t.prototype.removeLabels=function(e){for(var t=0;t<e.length;t++)delete this.labels[e[t]]},{AC:t}}),define("echo-4.0.3/delegate/rum/rum-delegate",["require","./label-keys","../../config/keys","../../util/methods","analytics_client"],function(e){function t(){return-1}function n(e,t,i,o){var a={server:i[r.RUM_URL],product:e},u=o.getHttpGet();u&&(a.delivery_method=n.AC.CUSTOM_GET,a.custom_delivery=function(e,t,n,s,r){u(s,r,e,t)}),o.getCookieGetter()&&(a.custom_cookie_getter=o.getCookieGetter()),o.getCookieSetter()&&(a.custom_cookie_setter=o.getCookieSetter()),this.ac=new n.AC(a),i[r.ECHO_TRACE]&&this.ac.addLabel(s.ECHO_TRACE,i[r.ECHO_TRACE],!0)}var s=e("./label-keys"),r=e("../../config/keys"),i=e("../../util/methods");return n.AC=e("analytics_client").AC,n.prototype.addLabels=function(e){this.ac.addLabels(e)},n.prototype.addLabel=function(e,t){this.ac.addLabel(e,t)},n.prototype.removeLabels=function(e){this.ac.removeLabels(e)},n.prototype.removeLabel=function(e){this.ac.removeLabels([e])},n.prototype.setCounterName=function(e){this.ac.addLabel(s.COUNTERNAME,e,!0)},n.prototype.setIsLoggedInToBBCId=t,n.prototype.setAppVersion=t,n.prototype.setContentLanguage=t,n.prototype.setDeviceID=t,n.prototype.viewEvent=function(e,t){this.ac.addLabel(s.COUNTERNAME,e,!0),this.ac.load(t)},n.prototype.errorEvent=function(e,t){var n=e.name+": "+e.message;this.ac.sendError(n,"",null,t)},n.prototype.userActionEvent=function(e,t,n){var r=i.extend({},!1,s.USER_ACTION_TYPE,e,s.USER_ACTION_NAME,t);this.ac._addEventAndSend(s.USER_ACTION_EVENT,r,n)},n.prototype.setPlayerName=t,n.prototype.setPlayerVersion=t,n.prototype.setPlayerIsPopped=t,n.prototype.setPlayerWindowState=t,n.prototype.setPlayerVolume=t,n.prototype.setPlayerIsSubtitled=t,n.prototype.setPlayerSize=t,n.prototype.setPlayerPositionGetter=t,n.prototype.setMedia=function(e){this._mediaLabels={},i.extend(this._mediaLabels,!1,s.MEDIA_PID,e.getContentId(),s.MEDIA_TYPE,e.getAvType(),s.MEDIA_ON_DEMAND,e.isOnDemand(),s.MEDIA_RETRIEVAL_TYPE,e.getRetrievalType(),s.MEDIA_LENGTH,e.getLength()),e.getBitrate()&&(this._mediaLabels[s.MEDIA_BITRATE]=e.getBitrate()),e.getCDN()&&(this._mediaLabels[s.MEDIA_CDN]=e.getCDN())},n.prototype.setMediaLength=function(e){this._mediaLabels[s.MEDIA_LENGTH]=e},n.prototype.setMediaBitrate=function(e){this._mediaLabels[s.MEDIA_BITRATE]=e},n.prototype.avPlayEvent=function(e,t){this.ac._addEventAndSend(s.AV_PLAY_EVENT,i.extend(this._mediaLabels,!0,s.MEDIA_POSITION,e),t)},n.prototype.avPauseEvent=function(e,t){this.ac._addEventAndSend(s.AV_PAUSE_EVENT,i.extend(this._mediaLabels,!0,s.MEDIA_POSITION,e),t)},n.prototype.avBufferEvent=t,n.prototype.avEndEvent=function(e,t){this.ac._addEventAndSend(s.AV_END_EVENT,i.extend(this._mediaLabels,!0,s.MEDIA_POSITION,e),t)},n.prototype.avRewindEvent=function(e,t,n){this.ac._addEventAndSend(s.AV_RW_EVENT,i.extend(this._mediaLabels,!0,s.MEDIA_POSITION,e),n)},n.prototype.avFastForwardEvent=function(e,t,n){this.ac._addEventAndSend(s.AV_FF_EVENT,i.extend(this._mediaLabels,!0,s.MEDIA_POSITION,e),n)},n.prototype.avSeekEvent=function(e,t){this.ac._addEventAndSend(s.AV_SEEK_EVENT,i.extend(this._mediaLabels,!0,s.MEDIA_POSITION,e),t)},n.prototype.avUserActionEvent=function(e,t,n,r){this.ac._addEventAndSend(s.AV_UA_EVENT,i.extend(this._mediaLabels,!0,s.MEDIA_POSITION,n,s.USER_ACTION_TYPE,e,s.USER_ACTION_NAME,t),r)},n}),define("echo-4.0.3/delegate/spring/label-keys",{STREAM:"stream",PID:"cq",WIDTH:"sx",HEIGHT:"sy",PLAYER_DESC:"pl",PLAYER_VERSION:"plv"}),define("springstreams",[],function(){function e(e){function t(){var e={"2cnt.net":{syncrates:[3,7,10,10,10,10,10,60]}};return e}function n(e){var t;if(e){for(var n in e)n==R&&(t=e[n]);t&&s(t.syncrates)}}function s(e){e&&(U=e)}function r(){return U}function i(e,t,n){if(e){var s=new g(this,e,t,n);return B.push(s),s}}function o(){setInterval(u,D),setInterval(l,O)}function a(){for(var e=0;e<B.length;++e)try{B[e].stop()}catch(t){_(t)}}function u(e){for(var t=0;t<B.length;++t)try{B[t].update(e)}catch(n){_(n)}}function l(e){for(var t=0;t<B.length;++t)try{B[t].sync(e)}catch(n){_(n)}}function _(e){f("",e)}function c(e,t){return h([[e,t]])}function p(e){return e&&void 0!=e.site?e.site:M}function d(){}function E(){return"https"==document.location.href.slice(0,5)?"https://ssl-":"http://"}function f(e,t){var n=E()+p(t)+"."+R+"/j0="+c(e,t);(new Image).src=n,this.debug(n)}function h(e){var t,n,s,r,i,o,a=/[+&,;=~]/g;switch(typeof e){case"string":return a.test(e)?escape(e).replace(a,function(e){var t=o[e];return t?t:e}):escape(e);case"number":return isFinite(e)?e.toString():"null";case"boolean":case"null":return e.toString();case"object":if(!e)return"null";if(t=[],"number"==typeof e.length&&!e.propertyIsEnumerable("length")){for(r=e.length,n=0;r>n;n+=1)t.push(h(e[n])||"null");return","+t.join("+")+";"}for(s in e)"string"==typeof s&&"site"!=s&&(i=h(e[s]),i&&t.push(h(s)+"="+i));return","+t.join("+")+";"}return""}function g(e,t,n,s){function r(e){var t=new Object;for(var n in e)t[n]=e[n];return t}function i(e){E.length<p.maxstates&&E.push(e)}function o(e){b=[e,e,Math.round((new Date).getTime()/1e3).toString(36)],i(b),L=!0,I=0}function a(){null!=m&&y<m.length&&(g=m[y++],p.debug("switch syncrate to "+g))}function u(){if(!S){var e=b[1],t=e;try{t=Math.round(h.getPosition(d))}catch(n){}try{if(e==t)return void(I>=0&&(I++,I==p.pausesync&&(L=!0)));I>=p.pausesync?o(t):t-1>e?o(t):e>t?o(t):(b[1]=t,b[1]-b[0]>=g&&t-P>=g&&(L=!0,a()),I=0)}catch(s){_=!0,p.error(s)}}}function l(){S||(L=!0,S=!0,c(null))}function c(){if(L){try{d.width&&(f.sx=d.width),d.videoWidth&&(f.sx=d.videoWidth),d.height&&(f.sy=d.height),d.videoHeight&&(f.sy=d.videoHeight)}catch(e){}f.uid=v,f.pst=E;var t;try{f.dur&&0!=f.dur||(f.dur=h.getDuration(d))}catch(e){}try{t=h.getMeta(d)}catch(e){}f.vt=Math.round((new Date).getTime()/1e3)-A,p.send(t,f),P=b[1]}L=!1}var p,d,E,f,h,g,m,y,v=Math.round(1e10*Math.random()).toString(36),A=Math.round((new Date).getTime()/1e3),b=[0,0,A.toString(36)],I=0,P=0,L=!0,S=!1;p=e,d=t,h=s?s:p.HTML5Adapter,f=r(n),E=new Array,E.push(b),y=0,g=e.syncrate,m=e.getSyncRates(),a(),this.update=u,this.stop=l,this.sync=c}function m(){return{pl:"HTML 5 Video",pv:"HTML 5",sx:screen.width,sy:screen.height}}function y(e){return Math.round(e.duration)}function v(e){return e.currentTime}function A(){return{pl:"DEF",pv:version,sx:screen.width,sy:screen.height}}function b(){return(new Date).getTime()/1e3}function I(){return 0}function P(e){return{pl:"MSWM",plv:e.versionInfo,sx:screen.width,sy:screen.height}}function L(e){return e.CurrentPosition?e.CurrentPosition:e.currentPosition?e.currentPosition:e.controls&&e.controls.currentPosition?e.controls.currentPosition:e.Controls&&e.Controls.currentPosition?e.Controls.currentPosition:0}function S(e){if(e.currentMedia){if(e.currentMedia.Duration)return e.currentMedia.Duration;if(e.currentMedia.duration)return e.currentMedia.duration}else if(e.CurrentMedia){if(e.CurrentMedia.duration)return e.CurrentMedia.duration;if(e.CurrentMedia.Duration)return e.CurrentMedia.Duration}}function C(e){return{pl:"RV",plv:e.GetVersionInfo(),sx:screen.width,sy:screen.height}}function T(e){return e.GetPosition()/1e3}function N(e){return e.GetLength()/1e3}this.version="1.4.0";var R="2cnt.net",D=200,O=2e3,M="default",B=new Array;this.syncrate=20,this.pausesync=6,this.maxstates=50;var U;n(t()),e&&(M=e),o(),this.getSyncRates=r,this.track=i,this.unload=a,this.doUpdate=u,this.doSync=l,this.error=_,this.debug=d,this.send=f,this.HTML5Adapter={getMeta:m,getPosition:v,getDuration:y},this.DefaultAdapter={getMeta:A,getPosition:b,getDuration:I},this.WMStreamAdapter={getMeta:P,getPosition:L,getDuration:S},this.RVStreamAdapter={getMeta:C,getPosition:T,getDuration:N}}return e}),define("echo-4.0.3/delegate/spring/spring-delegate",["require","./label-keys","../../config/keys","../../enumerations","../../util/debug","springstreams"],function(e){function t(){return-1}function n(e,t,n){this._sensors=null,this._positionGetter=null,this._media=null,this._meta={},this._stream=null,this._siteCode=n[r.BARB_SITE_CODE],this._debug=n[r.BARB_DEBUG]}var s=e("./label-keys"),r=e("../../config/keys"),i=e("../../enumerations"),o=e("../../util/debug"),a=i.MediaConsumptionMode;return n.SpringStreams=e("springstreams"),n.prototype.addLabels=t,n.prototype.addLabel=t,n.prototype.removeLabels=t,n.prototype.removeLabel=t,n.prototype.setIsLoggedInToBBCId=t,n.prototype.setAppVersion=t,n.prototype.setCounterName=t,n.prototype.viewEvent=t,n.prototype.errorEvent=t,n.prototype.userActionEvent=t,n.prototype.setPlayerName=function(e){this._meta[s.PLAYER_DESC]=e},n.prototype.setPlayerVersion=function(e){this._meta[s.PLAYER_VERSION]=e},n.prototype.setPlayerIsPopped=t,n.prototype.setPlayerWindowState=t,n.prototype.setPlayerVolume=t,n.prototype.setPlayerIsSubtitled=t,n.prototype.setPlayerPositionGetter=function(e){this._positionGetter=e},n.prototype.setPlayerSize=function(e,t){this._meta[s.WIDTH]=e,this._meta[s.HEIGHT]=t},n.prototype.setMedia=function(e){var t=this._media;this._media=e.getClone(),t&&t.getMediaConsumptionMode()===a.ON_DEMAND&&null!=this._stream&&(o.warn("Calling stream.stop()"),this._stream.stop(),this._stream=null)},n.prototype.setMediaLength=function(e){this._media.setLength(e)},n.prototype.setMediaBitrate=t,n.prototype.avPlayEvent=function(){if(null===this._stream&&this._media.getMediaConsumptionMode()===a.ON_DEMAND){if("function"!=typeof this._positionGetter)return void o.warn("Spring (BARB) reporting is disabled, to enable you must call echo.setPlayerDelegate");null===this._sensors&&(this._sensors=new n.SpringStreams(this._siteCode),this._debug&&(this._sensors.debug=function(e){o.log("Spring DEBUG: "+e)})),this._stream=this._sensors.track(this._media.getContentId(),this._getDesc(),this._getAdaptor())}},n.prototype._getDesc=function(){var e=this._media,t={};return e.isOnDemand()?(t[s.STREAM]="od",t[s.PID]=e.getContentId()):t[s.STREAM]="live/"+e.getServiceId(),this._meta[s.WIDTH]&&this._meta[s.HEIGHT]&&(t[s.WIDTH]=this._meta[s.WIDTH],t[s.HEIGHT]=this._meta[s.HEIGHT]),t},n.prototype._getAdaptor=function(){var e=this;return{getMeta:function(){return e._meta},getDuration:function(){return Math.floor(e._media.getLength()/1e3)},getPosition:function(){return Math.floor(e._positionGetter()/1e3)}}},n.prototype.avPauseEvent=t,n.prototype.avBufferEvent=t,n.prototype.avEndEvent=function(){null!=this._media&&this._media.getMediaConsumptionMode()===a.ON_DEMAND&&(this._stream&&this._stream.stop(),this._media=null,this._stream=null)},n.prototype.avRewindEvent=t,n.prototype.avFastForwardEvent=t,n.prototype.avSeekEvent=t,n.prototype.avUserActionEvent=t,n}),define("echo-4.0.3/client",["require","./util/debug","./util/methods","./config/keys","./enumerations","./config/generator","./util/helper","./util/methods","./delegate/comscore/comscore-delegate","./delegate/rum/rum-delegate","./delegate/spring/spring-delegate","./environment"],function(e){function t(e,n,o,a){s.assertContainsValue(i.ApplicationType,n,'appType should be one of Enums.ApplicationType, got "'+n+'"'),this.state={counterNameSet:!1};var u=t.ConfigGenerator.generate(o);u&&u[r.ECHO_ENABLED]||this._disable(),this._env=a||new t.Environment;var l=t.Environment._defaultGetCookie("bbc_identity");this.bbcCookies=this._env.getCookiePolicy(),"1"===l&&this.setIsLoggedInToBBCId(!0),this._configureForPerfCookies(u),this._setConsumers(t.Helper.cleanManagedLabelValue(e),n,u,this._env),u&&u[r.ECHO_DEVICE_ID]&&this.setDeviceID(u[r.ECHO_DEVICE_ID])}var n=e("./util/debug"),s=e("./util/methods"),r=e("./config/keys"),i=e("./enumerations");return t.ConfigGenerator=e("./config/generator"),t.Helper=e("./util/helper"),t.Util=e("./util/methods"),t.ComScoreDelegate=e("./delegate/comscore/comscore-delegate"),t.RumDelegate=e("./delegate/rum/rum-delegate"),t.SpringDelegate=e("./delegate/spring/spring-delegate"),t.Environment=e("./environment"),t.prototype._configureForPerfCookies=function(e){var t=this.bbcCookies.hasOptedOutOfPerformanceCookies();e&&t&&(e[r.BARB_ENABLED]=!1)},t.prototype._setConsumers=function(e,n,s,i){return this._isDisabled()?void(this.consumers={}):(this.consumers={},s[r.COMSCORE_ENABLED]&&(this.consumers[t.Consumers.COMSCORE]=new t.ComScoreDelegate(e,n,s,i)),s[r.RUM_ENABLED]&&(this.consumers[t.Consumers.RUM]=new t.RumDelegate(e,n,s,i)),s[r.BARB_ENABLED]&&(this.consumers[t.Consumers.BARB]=new t.SpringDelegate(e,n,s,i)),this)},t.prototype._delegate=function(e,t){for(var n in this.consumers)n&&this.consumers[n][e].apply(this.consumers[n],t);return this},t.prototype._disable=function(){return n.log("EchoClient disabled"),this._disabled=!0,this._setConsumers(),this},t.prototype._isDisabled=function(){return this._disabled},t.prototype.addLabels=function(e){return this._delegate("addLabels",[t.Helper.cleanLabels(e)]),this},t.prototype.addLabel=function(e,t){var n={};return n[e]=t,this.addLabels(n)},t.prototype.removeLabels=function(e){for(var n=[],s=0,r=e.length;r>s;s++)n.push(t.Helper.cleanLabelKey(e[s]));return this._delegate("removeLabels",[n]),this},t.prototype.setIsLoggedInToBBCId=function(e){return this._delegate("setIsLoggedInToBBCId",[e]),this},t.prototype.setAppVersion=function(e){return this._delegate("setAppVersion",[e]),this},t.prototype.setCounterName=function(e){return e=t.Helper.cleanCounterName(e),this._delegate("setCounterName",[e]),this.state.counterNameSet=!0,this},t.prototype.setContentLanguage=function(e){return this._delegate("setContentLanguage",[e]),this},t.prototype.setDeviceID=function(e){return this._deviceID=e,this._delegate("setDeviceID",[e]),this},t.prototype.getDeviceID=function(){if(this._deviceID)return this._deviceID;this.state.comscoreEventSent||n.warn("Call to getDeviceID before any events were sent, this could mean that the s1 cookie is not yet set on the client.");var e=this._env.getCookieGetter()||t.Environment._defaultGetCookie;return e("s1")},t.prototype.viewEvent=function(e,n){return e=t.Helper.cleanCounterName(e),this._delegate("viewEvent",[e,t.Helper.cleanLabels(n)]),this.state.counterNameSet=!0,this.consumers[t.Consumers.COMSCORE]&&(this.state.comscoreEventSent=!0),this},t.prototype.userActionEvent=function(e,s,r){var i=!1;return r&&r.name&&(i=!0,r.name=t.Helper.cleanCounterName(r.name)),this.state.counterNameSet||i?(this._delegate("userActionEvent",[e,s,t.Helper.cleanLabels(r)]),this.consumers[t.Consumers.COMSCORE]&&(this.state.comscoreEventSent=!0),this):(n.error('userActionEvent: Countername not set. Either pass in a "name" label or send a viewEvent/call setcounterName first'),this)},t.prototype.errorEvent=function(e,n){return this._delegate("errorEvent",[e,t.Helper.cleanLabels(n)]),this},t.prototype.setPlayerName=function(e){return s.assert("string"==typeof e&&e.length>0,'setPlayerName: name must be string with length, got "'+e+'"'),this._delegate("setPlayerName",[e]),this},t.prototype.setPlayerVersion=function(e){return s.assert("string"==typeof e&&e.length>0,'setPlayerVersion: version must be string with length, got "'+e+'"'),this._delegate("setPlayerVersion",[e]),this},t.prototype.setPlayerIsPopped=function(e){return s.assert("boolean"==typeof e,'setPlayerIsPopped: isPopped must be boolean, got "'+e+'"'),this._delegate("setPlayerIsPopped",[e]),this},t.prototype.setPlayerWindowState=function(e){return s.assertContainsValue(i.WindowState,e,'The window state must be set as a member of Enums.WindowState, got "'+e+'"'),this._delegate("setPlayerWindowState",[e]),this},t.prototype.setPlayerVolume=function(e){return s.assert(100>=e&&e>=0,"volume must be 0-100, got: "+e),this._delegate("setPlayerVolume",[e>100?100:0>e?0:e]),this},t.prototype.setPlayerIsSubtitled=function(e){return s.assert("boolean"==typeof e,'setPlayerIsSubtitled: isSubtitled must be a boolean, got "'+e+'"'),this._delegate("setPlayerIsSubtitled",[e]),this},t.prototype.setPlayerSize=function(e,t){return s.assert("number"==typeof e&&"number"==typeof t&&e>=0&&t>=0,"setPlayerSize: width and height should be numbers>=0, got: "+e+" and "+t),this._delegate("setPlayerSize",[e,t]),this},t.prototype.setPlayerPositionGetter=function(e){return s.assert("function"==typeof e,"setPlayerPositionGetter: postionGetter should be function, got "+typeof e),this._delegate("setPlayerPositionGetter",[e]),this},t.prototype.setMedia=function(e){var t=e.getClone();return this.state.counterNameSet?(this._delegate("setMedia",[t]),void(this.media=t)):(n.error("setMedia: Must have a countername set or view event sent first"),void(this.media=null))},t.prototype.setMediaLength=function(e){return this.media?this.media.isOnDemand()?this.media.lengthSet?(n.error("setMediaLength: Length can only be set once for a single piece of media"),this):0>e?(n.error('setMediaLength: Length must be gretaer than zero for on-demand media, got "'+e+'"'),this):(this._delegate("setMediaLength",[e]),this):(n.error("setMediaLength: Length should be set to zero prior to passing the media object to Echo for live media"),this):(n.error("setMediaLength: Must call setMedia first"),this)},t.prototype.setMediaBitrate=function(e){return s.assert(e>0,'setMediaBitrate: bitrate must be > 0, got "'+e+'"'),this._delegate("setMediaBitrate",[e]),this},t.prototype._avEventsEnabled=function(){return s.assert(this.media,"setMedia() must be called prior to this method"),null!==this.media&&"undefined"!=typeof this.media},t.prototype.avPlayEvent=function(e,n){return this._avEventsEnabled()?(this._delegate("avPlayEvent",[e,t.Helper.cleanLabels(n)]),this.consumers[t.Consumers.COMSCORE]&&(this.state.comscoreEventSent=!0),this):void 0},t.prototype.avPauseEvent=function(e,n){return this._avEventsEnabled()?(this._delegate("avPauseEvent",[e,t.Helper.cleanLabels(n)]),this):void 0},t.prototype.avBufferEvent=function(e,n){return this._avEventsEnabled()?(this._delegate("avBufferEvent",[e,t.Helper.cleanLabels(n)]),this):void 0},t.prototype.avEndEvent=function(e,n){return this._avEventsEnabled()?(this._delegate("avEndEvent",[e,t.Helper.cleanLabels(n)]),this):void 0},t.prototype.avRewindEvent=function(e,n,s){return this._avEventsEnabled()?(this._delegate("avRewindEvent",[e,n,t.Helper.cleanLabels(s)]),this):void 0},t.prototype.avFastForwardEvent=function(e,n,s){return this._avEventsEnabled()?(this._delegate("avFastForwardEvent",[e,n,t.Helper.cleanLabels(s)]),this):void 0},t.prototype.avSeekEvent=function(e,n){return this._avEventsEnabled()?(this._delegate("avSeekEvent",[e,t.Helper.cleanLabels(n)]),this):void 0},t.prototype.avUserActionEvent=function(e,n,s,r){if(this._avEventsEnabled()){var i=t.Helper.cleanLabels(r);return this._delegate("avUserActionEvent",[e,n,s,i]),this}},t.Consumers={COMSCORE:1,RUM:2,BARB:4},t}),define("echo-4.0.3/media",["require","./enumerations","./util/methods"],function(e){function t(e,s,r,i,a,_,c){this.contentId=e.replace(/\s/g,""),this.avType=s,this.pipsType=r||n.PIPsType.EPISODE,this.versionId=i.replace(/\s/g,""),this.serviceId=a,this.mediaConsumptionMode=_||u.ON_DEMAND,this.retrievalType=c,t._validate(this),this.length=this.isOnDemand()?l:0,this.bitrate=null,this.form=o.LONG,this.codec=null,this.cdn=null,this._scheduleMode=null,this.lengthSet=!1}var n=e("./enumerations"),s=e("./util/methods"),r=n.AvType,i=n.RetrievalType,o=n.Form,a=n.PIPsType,u=n.MediaConsumptionMode,l=6e4;return t._validate=function(e){s.assert("string"==typeof e.contentId&&e.contentId.length>0,'contentId must be a string with length, got "'+e.contentId+'"'),s.assert(e.contentId.match(/^[a-zA-Z0-9_-]+$/),"contentId must contain only valid characters"),s.assertContainsValue(r,e.avType,'avType must be on of AvType, got + "'+e.avType+'"'),s.assertContainsValue(a,e.pipsType,'pipsType must be on of Enums.PIPsType, got "'+e.pipsType+'"')||(e.pipsType=a.EPISODE),s.assert("string"==typeof e.versionId&&e.versionId.length>0,"versionId should be a non-empty string"),s.assert(e.versionId.match(/^[a-zA-Z0-9_-]+$/),"versionId must contain only valid characters"),s.assertContainsValue(i,e.retrievalType,'retrievalType must be one of Medias.RetrievalType, got "'+e.retrievalType+'"'),s.assertContainsValue(u,e.mediaConsumptionMode,"mediaConsumptionMode should be one of Enums.MediaConsumptionMode")||(e.mediaConsumptionMode=u.ON_DEMAND),e.mediaConsumptionMode===u.LIVE?(s.assert("string"==typeof e.serviceId&&e.serviceId.length>0,"serviceId should be non-empty string when Live"),s.assert(e.retrievalType===i.STREAM,'If the content is live, retreival type must be STREAM, got "'+e.retrievalType+'"')):s.assert(null===e.serviceId||"string"==typeof e.serviceId,"serviceId should be null when onDemand")
},t.prototype.setScheduleMode=function(e){return s.assertContainsValue(n.EchoScheduleMode,e,"scheduleMode should be one of Enums.EchoScheduelMode")&&(this._scheduleMode=e),this},t.prototype.getScheduleMode=function(){return this._scheduleMode||null},t.prototype.setLength=function(e){return s.assert(e>=0,"Length must be >= 0, got "+e),s.assert(this.isOnDemand()&&e>0||!this.isOnDemand()&&0===e,"Length must be > 0 for onDemand and 0 for live, got length "+e+" and onDemand = "+this.isOnDemand()),this.lengthSet=!0,this.length=Math.floor(e),this},t.prototype.setBitrate=function(e){return this.bitrate=e,this},t.prototype.setForm=function(e){return this.form=e,this},t.prototype.setCodec=function(e){return this.codec=e,this},t.prototype.setCDN=function(e){return this.cdn=e,this},t.prototype.getClone=function(){var e=new t(this.contentId,this.avType,this.pipsType,this.versionId,this.serviceId,this.mediaConsumptionMode,this.retrievalType);return e.length=this.length,e.bitrate=this.bitrate,e.form=this.form,e.codec=this.codec,e.cdn=this.cdn,e.lengthSet=this.lengthSet,e._scheduleMode=this._scheduleMode,e},t.prototype.getContentId=function(){return this.contentId},t.prototype.getAvType=function(){return this.avType},t.prototype.getPIPsType=function(){return this.pipsType},t.prototype.getVersionId=function(){return this.versionId},t.prototype.getServiceId=function(){return this.serviceId},t.prototype.getMediaConsumptionMode=function(){return this.mediaConsumptionMode},t.prototype.getRetrievalType=function(){return this.retrievalType},t.prototype.getLength=function(){return this.length},t.prototype.getBitrate=function(){return this.bitrate},t.prototype.getForm=function(){return this.form},t.prototype.getCodec=function(){return this.codec},t.prototype.getCDN=function(){return this.cdn},t.prototype.isVideo=function(){return this.avType===r.VIDEO},t.prototype.isEpisode=function(){return this.pipsType===a.EPISODE},t.prototype.isOnDemand=function(){return this.mediaConsumptionMode===u.ON_DEMAND},t}),define("echo-4.0.3/bootstrap",["require","./meta","./client","./media","./environment","./enumerations","./config/keys","./util/debug"],function(e){var t=e("./meta"),n={EchoClient:e("./client"),Media:e("./media"),Environment:e("./environment"),Enums:e("./enumerations"),ConfigKeys:e("./config/keys"),Debug:e("./util/debug"),getAPIVersion:function(){return t.API_VERSION},getImplementationVersion:function(){return t.VERSION}};return n}),define("echo-4.0.3",["require","echo-4.0.3/bootstrap"],function(e){return e("echo-4.0.3/bootstrap")});